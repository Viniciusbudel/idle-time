# PLAN: Production Rebalance & Offline Tuning

> **Feature:** Total game rebalance targeting offline vs active play, technology scaling, and artifact power multipliers.
> **Goal:** Align with standard idle game metrics. Active play should be the primary driver for progress (worker gacha/merging). Offline gains should represent minor steady progress, not allowing the player to easily skip entire eras.
> **Status:** Planning Phase

---

## ðŸŽ¼ Orchestration Requirements

**This is a complex balancing operation requiring a minimum of 3 simulated agents working sequentially:**

| # | Agent | Focus Area | Goal |
|---|-------|------------|------|
| 1 | `project-planner` | Architecture | Structuring this document and creating the step-by-step roadmap |
| 2 | `game-developer` | Core Math & Mechanics | Adjusting the constants for Tech, Stations, Time Warp, and Offline equations |
| 3 | `test-engineer` | Validation | Ensuring tests correspond to the new rebalanced equations |

---

## ðŸ“Š Design Philosophy & Idle Metrics

**Industry Standard Idle Metrics:**
- **Active Play Requirement:** Advancing an era should take hours/days of *active* management (upgrading, merging, prestige), not just closing the app for 24h.
- **Offline Cap:** Offline progress usually caps at 10-25% of active efficiency, often hard-capped to a maximum of 12-24 hours.
- **Artifact Balance:** Buffs from items should feel powerful but *additive* to base stats, not completely multiplicative overlapping to break the curve early on.

**Current Issues in Time Factory:**
1. **Offline Gains are too high.** 
2. **Artifacts buff too hard.** Common/Rare artifacts provide multipliers that scale out of control when combined with Station multipliers and Tech Multipliers.
3. **Tech Upgrades.** Costs don't scale fast enough compared to the CE/sec generated by mid-game worker combinations.

---

## ðŸ”§ Remaining Work â€” Small Wins

> These wins should be executed bottom-up. Each win provides a specific mechanical change to fix the economy.

### WIN 1 â€” Offline Progress Hard Nerf
**Agent:** `game-developer`
**Skills:** `clean-code`, `game-development`
**Workflow:** `/enhance`

- [ ] Open `lib/domain/entities/game_state.dart`
- [ ] Locate `get offlineEfficiency`. Change base efficiency from `0.7` (70%) to `0.1` (10%).
- [ ] Add a maximum offline accumulation time (e.g., max 12 hours) in `OfflineProgressUseCase`. If the player is away for 5 days, they only get 12 hours worth of 10% efficiency.
- [ ] Reconfigure `TechData.calculateOfflineEfficiencyMultiplier` to offer smaller buffs (e.g., +5% per tech level, maxing out at perhaps 30-40% total offline efficiency across the whole game).

---

### WIN 2 â€” Artifact Math Rebalancing
**Agent:** `game-developer`
**Skills:** `game-development`
**Workflow:** `/enhance`

- [x] Open `lib/domain/entities/worker_artifact.dart`.
- [x] Review `WorkerArtifact.generate()` bounds and formulas.
- [x] Decrease the maximum `basePowerBonus` drop numbers. 
- [x] CRITICAL: Reduce `productionMultiplier`. A common artifact shouldn't double (1.0+) production. Shift common multipliers to `0.02` (+2%), rare to `0.05` (+5%), epic to `0.1` (+10%), etc.
- [x] Ensure `Worker.totalMultiplier` math in `worker.dart` is correctly adding these tiny percentages rather than compounding them excessively.

---

### WIN 3 â€” Tech and Station Cost Curve Adjustments
**Agent:** `game-developer`
**Skills:** `game-development`
**Workflow:** `/enhance`

- [x] Open `lib/core/constants/tech_data.dart` and `lib/domain/entities/station.dart`.
- [x] Increase the cost multiplier for levelling up Stations (e.g., from `2.0` to `2.5` or `3.0` for higher tier stations).
- [x] Review Tech upgrade costs. The exponential curve for Tech needs to be steeper so players are forced to grind `Time Shards` and `Prestige` before maxing out an era.
- [x] Adjust Tech efficiency bonuses. (e.g. `TechData.calculateEfficiencyMultiplier`).

---

### WIN 4 â€” Active Play Buff (Cell/Worker Merge)
**Agent:** `game-developer`
**Skills:** `game-development`
**Workflow:** `/enhance`

- [ ] If offline gains are nerfed, active merging must feel more rewarding to compensate.
- [ ] Review `MergeWorkersUseCase`. Ensure that higher rarity workers (Epic/Legendary) provide significant base power that outpaces standard station leveling. 
- [ ] Consider adding a small manual click bonus or "active" session multiplier (e.g., `currentProduction` gets a 1.2x boost while the app is open).

---

### WIN 5 â€” Validation and Testing
**Agent:** `test-engineer`
**Skills:** `testing-patterns`
**Workflow:** `/test`

- [ ] Run `flutter test` to identify broken tests resulting from mathematical changes to Station Upgrade costs, Offline Progress efficiency, and Artifact generation.
- [ ] Update `test/domain/offline_progress_usecase_test.dart` (or equivalent) to assert the new 12-hour cap and 10% base efficiency.
- [ ] Run Python validation scripts if required by the workspace protocol (`python .agent/scripts/checklist.py .`).

---

## ðŸ Phase 2 Verification Requirements

- [ ] **Offline Check:** Close app, wait 1 minute, open app -> Ensure offline popup shows significantly lower CE than 1 minute of active play.
- [ ] **Artifact Check:** Generate a Common artifact. Equip it. Production should rise by a tiny, balanced margin (e.g. +2%), not double.
- [ ] **Progression Check:** User cannot unlock the second era without prestiging or grinding active worker merges.
